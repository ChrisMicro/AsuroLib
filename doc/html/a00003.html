<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ASURO Library: asuro.c-Dateireferenz</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ASURO Library
   &#160;<span id="projectnumber">2.80</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Erzeugt von Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Hauptseite</span></a></li>
      <li class="current"><a href="files.html"><span>Dateien</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Auflistung&#160;der&#160;Dateien</span></a></li>
      <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Makrodefinitionen</a> &#124;
<a href="#func-members">Funktionen</a> &#124;
<a href="#var-members">Variablen</a>  </div>
  <div class="headertitle">
<div class="title">asuro.c-Dateireferenz</div>  </div>
</div><!--header-->
<div class="contents">

<p>Init- und Interrupt-Funktionen der Asuro Library.<br/>
 Timer2 wird mit 36 kHz betrieben, im Gegensatz zur ausgelieferten<br/>
 Version mit 72 kHz.  
<a href="#details">Mehr ...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="a00004_source.html">asuro.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="a00019_source.html">myasuro.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include-AbhÃ¤ngigkeitsdiagramm fÃ¼r asuro.c:</div>
<div class="dyncontent">
<div class="center"><img src="a00034.png" border="0" usemap="#asuro_8c" alt=""/></div>
<map name="asuro_8c" id="asuro_8c">
</map>
</div>
</div>
<p><a href="a00003_source.html">gehe zum Quellcode dieser Datei</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Makrodefinitionen</h2></td></tr>
<tr class="memitem:ad4455691936f92fdd6c37566fc58ba1f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#ad4455691936f92fdd6c37566fc58ba1f">BAUD_RATE</a>&#160;&#160;&#160;2400</td></tr>
<tr class="separator:ad4455691936f92fdd6c37566fc58ba1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Funktionen</h2></td></tr>
<tr class="memitem:acfda1442e71f6d530ce46f93061edb64"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#acfda1442e71f6d530ce46f93061edb64">IsrStandard</a> (void)</td></tr>
<tr class="separator:acfda1442e71f6d530ce46f93061edb64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ce0a14b6e7779fbb2d9a05333792c41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a7ce0a14b6e7779fbb2d9a05333792c41">Init</a> (void)</td></tr>
<tr class="memdesc:a7ce0a14b6e7779fbb2d9a05333792c41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialisiert die Hardware: Ports, A/D Wandler, Serielle Schnittstelle, PWM<br/>
 Die Init Funktion muss von jeden Programm beim Start aufgerufen werden.  <a href="#a7ce0a14b6e7779fbb2d9a05333792c41"></a><br/></td></tr>
<tr class="separator:a7ce0a14b6e7779fbb2d9a05333792c41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a695028df1fc0b1724dd9e5efed5c47cf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a695028df1fc0b1724dd9e5efed5c47cf">SIGNAL</a> (TIMER2_OVF_vect)</td></tr>
<tr class="separator:a695028df1fc0b1724dd9e5efed5c47cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aece713876b70fea279b7ef4cfb35d24d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#aece713876b70fea279b7ef4cfb35d24d">if</a> (!<a class="el" href="a00004.html#a61610ea211b4bea5cc5ce6136c3fa4f8">count36kHz</a>) <a class="el" href="a00004.html#a8f07cc475f4e813c344e44a6efce8bc2">timebase</a>++</td></tr>
<tr class="separator:aece713876b70fea279b7ef4cfb35d24d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3411350ac14105d620aa51ece56602c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a3411350ac14105d620aa51ece56602c2">SIGNAL</a> (ADC_vect)</td></tr>
<tr class="separator:a3411350ac14105d620aa51ece56602c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variablen</h2></td></tr>
<tr class="memitem:a96d1662336df94f7822af3790984c9b8"><td class="memItemLeft" align="right" valign="top">volatile unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a96d1662336df94f7822af3790984c9b8">adcValue</a> [6]</td></tr>
<tr class="separator:a96d1662336df94f7822af3790984c9b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">AusfÃ¼hrliche Beschreibung</h2>
<div class="textblock"><p>Init- und Interrupt-Funktionen der Asuro Library.<br/>
 Timer2 wird mit 36 kHz betrieben, im Gegensatz zur ausgelieferten<br/>
 Version mit 72 kHz. </p>
<dl class="section user"><dt>Interrupt-Doku nur ueber die Datei zu sehen:</dt><dd>Bitte ueber den oben ausgegebenen Link <b>'gehe</b> <b>zum</b> <b>Quellcode</b> <br/>
 <b>dieser</b> <b>Datei'</b> direkt in der Datei nachsehen.<br/>
 DoxyGen ist nicht zur Erkennung von Interrupt-Funktionen 'bereit'.<br/>
 Behandelt werden folgende Interrupts:<br/>
<ul>
<li>TIMER2_OVF_vect : Timer 2 (fest mit 36 kHz belegt)<br/>
</li>
<li>ADC_vect : Analog-Digital-Wandler</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Wichtiger Hinweis:</dt><dd>Die <a class="el" href="a00003.html#a7ce0a14b6e7779fbb2d9a05333792c41" title="Initialisiert die Hardware: Ports, A/D Wandler, Serielle Schnittstelle, PWM  Die Init Funktion muss v...">Init()</a>-Funktion muss von jedem Programm beim Start<br/>
 aufgerufen werden.<br/>
</dd></dl>
<dl class="section see"><dt>Siehe auch</dt><dd>Defines zum setzen von Port's und Konfigurationen in <a class="el" href="a00004.html" title="Definitionen und Funktionen der ASURO Bibliothek.">asuro.h</a><br/>
 <a class="el" href="a00004.html#ab6f754da67bdaa2a24c0395b79dd577d">IRTX</a>, <a class="el" href="a00004.html#a748e2ff253570331d3cd8f51ccc17f03">LEFT_DIR</a>, <a class="el" href="a00004.html#a538e3ec60828cfabae7e3011d73d2093">PWM</a>, <a class="el" href="a00004.html#a01649d652fa50957c6ef3c32b1238038">GREEN_LED</a>, <a class="el" href="a00004.html#a280580881770229c533faab28f235a05">RIGHT_DIR</a>, <a class="el" href="a00004.html#ad9567ac44225342551d4e5adcf2dd81a">FRONT_LED</a>,<br/>
 <a class="el" href="a00004.html#a176882b8d1388d28d08cfd08e09f7c42">ODOMETRIE_LED</a>, <a class="el" href="a00004.html#a073dbcb7f5bc4f4b45dc048b55eaff3d">RED_LED</a>, <a class="el" href="a00004.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>, <a class="el" href="a00004.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>, <a class="el" href="a00004.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a>, <a class="el" href="a00004.html#aa02f16883c5ce325e2dbb8c3835aa9a1">FWD</a>, <a class="el" href="a00004.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="el" href="a00004.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></dd></dl>
<dl class="section version"><dt>Version</dt><dd>V&mdash; - 10.11.2003 - Jan Grewe - DLR<br/>
 Original Version von der ASURO CD<br/>
 </dd>
<dd>
V&mdash; - 20.11.2006 - m.a.r.v.i.n<br/>
 +++ SIGNAL (ADC_vect)<br/>
 static Variable toggle mit FALSE initialisiert.<br/>
 (Bug report von Rolf_Ebert) </dd>
<dd>
V&mdash; - bis zum 07.01.2007 - <br/>
 Bitte in Datei CHANGELOG nachsehen.<br/>
 </dd>
<dd>
V001 - 13.01.2007 - m.a.r.v.i.n<br/>
 +++ Alle Funktionen<br/>
 Zerlegte Sourcen in einzelne Dateien fuer eine echte Library. </dd>
<dd>
V002 - 27.01.2007 - Sternthaler<br/>
 +++ Alle Funktionen<br/>
 Kommentierte Version (KEINE Funktionsaenderung) </dd>
<dd>
V003 - 20.02.2007 - m.a.r.v.i.n<br/>
 Defines fuer Dometrie High/Low Werte aus <a class="el" href="a00019.html" title="Benutzerspezische Definitionen der ASURO Bibliothek.">myasuro.h</a> verwenden StopSwitch ersetzt. Deshalb wurde immer die komplette switches.o mitgelinkt </dd>
<dd>
V004 - 15.11.2007 - m.a.r.v.i.n<br/>
 RIGHT_DIR und LEFT_DIR waren in der Init Funktion vertauscht </dd>
<dd>
V005 - 29.01.2008 - m.a.r.v.i.n<br/>
 Initialisierung fuer ATmega168<br/>
 UART Baudrate einstellbar durch Define<br/>
 Interrupt User Funktionen für Timer und A/D Wandler </dd>
<dd>
V006 - 29.03.2009 - rossir<br/>
 A/D Wandler Abfrage ueber Interrupt </dd>
<dd>
V007 - 2013-11-25 - matze Some SIGNALS became deprecated, so I replaced them: SIG_OVERFLOW2 -&gt; TIMER2_OVF_vect SIG_OUTPUT_COMPARE2A -&gt; TIMER2_COMPA_vect SIG_OUTPUT_COMPARE2 -&gt; TIMER2_COMP_vect SIG_ADC -&gt; ADC_vect </dd></dl>

<p>Definiert in Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>
</div><h2 class="groupheader">Makro-Dokumentation</h2>
<a class="anchor" id="ad4455691936f92fdd6c37566fc58ba1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BAUD_RATE&#160;&#160;&#160;2400</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definiert in Zeile <a class="el" href="a00003_source.html#l00070">70</a> der Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Dokumentation der Funktionen</h2>
<a class="anchor" id="aece713876b70fea279b7ef4cfb35d24d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if </td>
          <td>(</td>
          <td class="paramtype">!&#160;</td>
          <td class="paramname"><em>count36kHz</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>being used insted TIMER2_OVF_vect during ultrasonic polling </p>

</div>
</div>
<a class="anchor" id="a7ce0a14b6e7779fbb2d9a05333792c41"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialisiert die Hardware: Ports, A/D Wandler, Serielle Schnittstelle, PWM<br/>
 Die Init Funktion muss von jeden Programm beim Start aufgerufen werden. </p>
<dl class="section see"><dt>Siehe auch</dt><dd>Die Funktionen <a class="el" href="a00026.html#a99b57953c558fb6618e2bd10ef291546" title="Wartefunktion.">Sleep()</a> und <a class="el" href="a00026.html#a01c23edeb03966f9b72b12a86d7c648a" title="Wartefunktion in ms.">Msleep()</a> in <a class="el" href="a00026.html" title="Zeit- und Delay Funktionen.">time.c</a> werden mit dem hier<br/>
 eingestellten 36 kHz-Takt betrieben.<br/>
</dd></dl>
<dl class="section user"><dt>Funktionsweise der Zeitfunktionen:</dt><dd><a class="el" href="a00026.html#a01c23edeb03966f9b72b12a86d7c648a" title="Wartefunktion in ms.">Msleep()</a> ruft <a class="el" href="a00026.html#a99b57953c558fb6618e2bd10ef291546" title="Wartefunktion.">Sleep()</a> auf. In <a class="el" href="a00026.html#a99b57953c558fb6618e2bd10ef291546" title="Wartefunktion.">Sleep()</a> wird die globale Variable count36kHz<br/>
 zur Zeitverzoegerung benutzt. Diese Variable wird jedesmal im Interrupt<br/>
 TIMER2_OVF_vect um 1 hochgezaehlt.<br/>
 Der Interrupt selber wird durch den hier eingestellten Timer ausgeloesst.<br/>
 Somit ist dieser Timer fuer die Zeitverzoegerung zustaendig.</dd></dl>
<dl class="section see"><dt>Siehe auch</dt><dd>Die globale Variable <a class="el" href="a00004.html#ae76207f3fd37582724c51dc31b0e729b" title="Steuert, ob die Odometrie-Sensor Abfrage im Interrupt Betrieb laufen soll.">autoencode</a> fuer die automatische Bearbeitung der<br/>
 Odometrie-ADC-Wandler wird hier auf <a class="el" href="a00004.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> gesetzt.</dd></dl>
<dl class="section user"><dt>Hinweis zur 36 kHz-Frequenz vom Timer 2</dt><dd>Genau diese Frequenz wird von dem Empfaengerbaustein benoetigt und kann<br/>
 deshalb nicht geaendert werden.<br/>
 In der urspruenglichen, vom Hersteller ausgelieferten LIB, war diese<br/>
 Frequenz allerdings auf 72 kHz eingestellt. Durch eine geschickte<br/>
 Umkonfigurierung durch waste konnte diese aber halbiert werden.<br/>
 Sinnvoll ist dies, da der durch diesen Timer2 auch ausgeloesste Timer-<br/>
 Interrupt dann nur noch die Haelfte an Rechenzeit in Anspruch nimmt.</dd></dl>
<dl class="section user"><dt>Beispiel:</dt><dd>(Nur zur Demonstration der Parameter/Returnwerte) <div class="fragment"><div class="line"><span class="comment">// Die Init()-Funktion MUSS IMMER zu Anfang aufgerufen werden.</span></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> wert;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="a00003.html#a7ce0a14b6e7779fbb2d9a05333792c41" title="Initialisiert die Hardware: Ports, A/D Wandler, Serielle Schnittstelle, PWM  Die Init Funktion muss v...">Init</a> ();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (1)</div>
<div class="line">  (</div>
<div class="line">      <span class="comment">// Dein Programm</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>

<p>Definiert in Zeile <a class="el" href="a00003_source.html#l00228">228</a> der Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    Timer2, zum Betrieb mit der seriellen Schnittstelle, fuer die</span></div>
<div class="line"><span class="comment">    IR-Kommunikation auf 36 kHz eingestellt.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"><span class="preprocessor">#if defined(__AVR_ATmega168__)</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="comment">// fast PWM, set OC2A on compare match, clear OC2A at bottom, clk/1</span></div>
<div class="line">  TCCR2A = _BV(WGM20) | _BV(WGM21) | _BV(COM2A0) | _BV(COM2A1);</div>
<div class="line">  TCCR2B = _BV(CS20);</div>
<div class="line">  <span class="comment">// interrupt on timer overflow</span></div>
<div class="line">  TIMSK2 |= _BV(TOIE2); </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="comment">// fast PWM, set OC2A on compare match, clear OC2A at bottom, clk/1</span></div>
<div class="line">  TCCR2 = _BV(WGM20) | _BV(WGM21) | _BV(COM20) | _BV(COM21) | _BV(CS20);</div>
<div class="line">  <span class="comment">// interrupt on timer overflow</span></div>
<div class="line">  TIMSK |= _BV(TOIE2); </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="comment">// 36kHz carrier/timer</span></div>
<div class="line">  OCR2  = 0x91;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    Die serielle Schnittstelle wurde waerend der Boot-Phase schon</span></div>
<div class="line"><span class="comment">    programmiert und gestartet. Hier werden die Parameter auf 2400 1N8 gesetzt.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"><span class="preprocessor">#if defined(__AVR_ATmega168__)</span></div>
<div class="line"><span class="preprocessor"></span>   UBRR0L = (uint8_t)(F_CPU/(<a class="code" href="a00003.html#ad4455691936f92fdd6c37566fc58ba1f">BAUD_RATE</a>*16L)-1);</div>
<div class="line">   UBRR0H = (F_CPU/(<a class="code" href="a00003.html#ad4455691936f92fdd6c37566fc58ba1f">BAUD_RATE</a>*16L)-1) &gt;&gt; 8;</div>
<div class="line">   UCSR0B = (1&lt;&lt;RXEN0) | (1&lt;&lt;TXEN0);</div>
<div class="line">   UCSR0C = (1&lt;&lt;UCSZ00) | (1&lt;&lt;UCSZ01);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>  UBRRH = (((F_CPU/<a class="code" href="a00003.html#ad4455691936f92fdd6c37566fc58ba1f">BAUD_RATE</a>)/16)-1)&gt;&gt;8;        <span class="comment">// set baud rate</span></div>
<div class="line">  UBRRL = (((F_CPU/<a class="code" href="a00003.html#ad4455691936f92fdd6c37566fc58ba1f">BAUD_RATE</a>)/16)-1);</div>
<div class="line">  UCSRB = (1&lt;&lt;RXEN)|(1&lt;&lt;TXEN);  <span class="comment">// enable Rx &amp; Tx</span></div>
<div class="line">  UCSRC = (1&lt;&lt;URSEL)|(1&lt;&lt;UCSZ1)|(1&lt;&lt;UCSZ0);  <span class="comment">// config USART; 8N1</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    Datenrichtung der I/O-Ports festlegen. Dies ist durch die Beschaltung der</span></div>
<div class="line"><span class="comment">    Asuro-Hardware nicht aenderbar.</span></div>
<div class="line"><span class="comment">    Port B: Seriell Senden; Richtungsvorgabe Motor links; Takt fuer die</span></div>
<div class="line"><span class="comment">            Geschwindigkeit beider Motoren; Grueneanteil-Status-LED</span></div>
<div class="line"><span class="comment">    Port D: Richtungsvorgabe Motor rechts; Vordere LED;</span></div>
<div class="line"><span class="comment">            Odometrie-LED (Radsensor); Rotanteil-Status-LED</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  DDRB = <a class="code" href="a00004.html#ab6f754da67bdaa2a24c0395b79dd577d">IRTX</a> | <a class="code" href="a00004.html#a280580881770229c533faab28f235a05">RIGHT_DIR</a> | <a class="code" href="a00004.html#a538e3ec60828cfabae7e3011d73d2093">PWM</a> | <a class="code" href="a00004.html#a01649d652fa50957c6ef3c32b1238038">GREEN_LED</a>;</div>
<div class="line">  DDRD = <a class="code" href="a00004.html#a748e2ff253570331d3cd8f51ccc17f03">LEFT_DIR</a> | <a class="code" href="a00004.html#ad9567ac44225342551d4e5adcf2dd81a">FRONT_LED</a> | <a class="code" href="a00004.html#a176882b8d1388d28d08cfd08e09f7c42">ODOMETRIE_LED</a> | <a class="code" href="a00004.html#a073dbcb7f5bc4f4b45dc048b55eaff3d">RED_LED</a> | <a class="code" href="a00004.html#a982e6a0873b4ed1df90a1f963e49a551">SWITCHES</a>;  <span class="comment">// Port-Bits als Output</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    PWM-Kanaele OC1A und OC1B auf 8-Bit einstellen.</span></div>
<div class="line"><span class="comment">    Sie werden fuer die Geschwindigkeitsvorgaben der Motoren benutzt.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  TCCR1A = _BV(WGM10) | _BV(COM1A1) | _BV(COM1B1);</div>
<div class="line">  TCCR1B = _BV(CS11);                 <span class="comment">// tmr1-Timer mit MCU-Takt/8 betreiben.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    Sonstige Vorbereitungen.</span></div>
<div class="line"><span class="comment">    - Alle LED&#39;s ausschalten</span></div>
<div class="line"><span class="comment">    - Motoren stoppen und schon mal auf Vorwaerts einstellen.</span></div>
<div class="line"><span class="comment">    - Globale Variable autoencoder ausschalten.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <a class="code" href="a00015.html#a6172056141d8849a882e557e4440f1b7" title="Steuert die vorne, nach unten zeigende, Front-LED.">FrontLED</a> (<a class="code" href="a00004.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>);</div>
<div class="line">  <a class="code" href="a00015.html#a93d1d19e89aa6b1aab442897b024332a" title="Steuert die beiden hinteren Back-LED&#39;s  Wenn diese Funktion aufgerufen wird, funktioniert die Odometr...">BackLED</a> (<a class="code" href="a00004.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>, <a class="code" href="a00004.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>);</div>
<div class="line">  <a class="code" href="a00015.html#a93d1d19e89aa6b1aab442897b024332a" title="Steuert die beiden hinteren Back-LED&#39;s  Wenn diese Funktion aufgerufen wird, funktioniert die Odometr...">BackLED</a> (<a class="code" href="a00004.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>, <a class="code" href="a00004.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>);</div>
<div class="line">  <a class="code" href="a00015.html#a93d71b825dd56c077d5abcc1c8eec078" title="Steuert die (lustige) mehrfarbige Status-LED.">StatusLED</a> (<a class="code" href="a00004.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a>);</div>
<div class="line">  <a class="code" href="a00004.html#a3027aae495fb6502790df1ed3aa8d133">SWITCH_ON</a>; </div>
<div class="line"></div>
<div class="line">  <a class="code" href="a00017.html#a561935d5de881e56c9ad4592514cf47f" title="Steuert die Drehrichtung der Motoren.">MotorDir</a> (<a class="code" href="a00004.html#aa02f16883c5ce325e2dbb8c3835aa9a1">FWD</a>, <a class="code" href="a00004.html#aa02f16883c5ce325e2dbb8c3835aa9a1">FWD</a>);</div>
<div class="line">  <a class="code" href="a00017.html#a72bb9f060fd3b5a9a9471b84bef882cd" title="Steuert die Geschwindigkeit der Motoren.">MotorSpeed</a> (0, 0);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="a00007.html#ae76207f3fd37582724c51dc31b0e729b" title="Steuert, ob die Odometrie-Sensor Abfrage im Interrupt Betrieb laufen soll.">autoencode</a> = <a class="code" href="a00004.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="a00007.html#ab3982e6520803bb438468a0352755a28" title="Zeiger auf User Funktion die von der Interupt Funktion aus aufgerufen wird.">Ovr2IntFunc</a> = 0;</div>
<div class="line">  <a class="code" href="a00007.html#acb2dd119fea212b6ce56cd76e1076825" title="Zeiger auf User Funktion die von der Interupt Funktion aus aufgerufen wird.">AdcIntFunc</a> = <a class="code" href="a00003.html#acfda1442e71f6d530ce46f93061edb64">IsrStandard</a>;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">   * Vorbereitung für WHEEL-Interrupts (Encoder)</span></div>
<div class="line"><span class="comment">    Port C als Input =&gt; dadurch gehen die Back-LED aus ...</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  DDRC &amp;= ~ (_BV(PC0) | _BV(PC1));</div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    ... aber nun koennen die LED&#39;s am Rad eingeschaltet werden, und die</span></div>
<div class="line"><span class="comment">        Sensoren koennen gemessen werden.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <a class="code" href="a00004.html#acc3bde0465346259ff3610da21d22330">ODOMETRIE_LED_ON</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    Linken Odometrie-Sensor auswaehlen. (AVCC ref. with external capacitor)</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  ADMUX = _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#a264bd2d371afa11900d69cc549bbe46e">WHEEL_LEFT</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    AD-Wandler einschalten, Parameter einstellen und Starten. (clk/128)</span></div>
<div class="line"><span class="comment">    Startet den ADC im &#39;free running&#39;-Mode (ADFR). Das heisst, der Wandler</span></div>
<div class="line"><span class="comment">    nach einer Messung automatisch wieder neu startet.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  ADCSRA = _BV(ADEN) | _BV(ADFR) | _BV(ADIE) | _BV(ADSC) | _BV(ADPS0) | _BV(ADPS1) | _BV(ADPS2);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    Funktion zum ALLGEMEINEN ZULASSEN von Interrupts.</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  sei ();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acfda1442e71f6d530ce46f93061edb64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void IsrStandard </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definiert in Zeile <a class="el" href="a00003_source.html#l00138">138</a> der Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> sign[2]={1,1}, avg[2], adc_cnt = 0;</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mux[]={</div>
<div class="line">                _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#a282f4557df06f675f8800bf24f71cf06">IR_RIGHT</a>,     <span class="comment">// AVCC reference with external capacitor</span></div>
<div class="line">                _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#a195bd11b05780db950588032e99591cb">IR_LEFT</a>,      <span class="comment">// AVCC reference with external capacitor</span></div>
<div class="line">                _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#ac279a93dfd1f02dac2359cfaa1422b93">SWITCH</a>,</div>
<div class="line">                _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#aa166a7eb75c6a068aaa40873a2ddc58a">BATTERIE</a> | _BV(REFS1),        <span class="comment">// internal 2.56V reference with external capacitor</span></div>
<div class="line">                _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#a19f8ef9313a09ac75f34cac1162f40a5">WHEEL_RIGHT</a>,  <span class="comment">// AVCC reference with external capacitor</span></div>
<div class="line">                _BV(ADLAR) | _BV(REFS0) | <a class="code" href="a00004.html#a264bd2d371afa11900d69cc549bbe46e">WHEEL_LEFT</a>,   <span class="comment">// AVCC reference with external capacitor</span></div>
<div class="line">        };</div>
<div class="line">        <span class="comment">// Vielleicht hat Rakke ja Recht: </span></div>
<div class="line">        <span class="comment">// ADCL muss zuerst gelesen werden! Sonst können sich zwei Wandlungen überschneiden.</span></div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sensor = ADCL | (ADCH &lt;&lt; 8);       </div>
<div class="line">        <a class="code" href="a00003.html#a96d1662336df94f7822af3790984c9b8">adcValue</a>[adc_cnt]=sensor;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="a00007.html#ae76207f3fd37582724c51dc31b0e729b" title="Steuert, ob die Odometrie-Sensor Abfrage im Interrupt Betrieb laufen soll.">autoencode</a>)          <span class="comment">// Aus Kompatibilitätsgründen wird autoencode weiter benutzt</span></div>
<div class="line">        {</div>
<div class="line">                <span class="keywordflow">if</span>(adc_cnt&lt;2) { <span class="comment">// WHEEL_RIGHT || WHEEL_LEFT</span></div>
<div class="line">                <span class="keywordtype">int</span> s=(sensor &gt;&gt; 8); </div>
<div class="line">                    <span class="comment">// In avg wird ein gleitender Mittelwert mitgeführt: a(n+1) = 0.75*a(n)+0.25*s</span></div>
<div class="line">                    avg[adc_cnt] += (s-avg[adc_cnt])&gt;&gt;2; </div>
<div class="line">                </div>
<div class="line">                        <span class="comment">// Schneidet die aktuelle Sensorkurve den gleitenden Mittelwert? Konkret:</span></div>
<div class="line">                    <span class="comment">// Weicht der aktuelle Sensorwert um mehr als +/- 2 vom gleitenden Mittelwert ab? </span></div>
<div class="line">                    <span class="keywordflow">if</span> (sign[adc_cnt]*(s-avg[adc_cnt]) &gt; 2) </div>
<div class="line">                    { </div>
<div class="line">                       <span class="comment">// Dann zähle einen Tick weiter. </span></div>
<div class="line">                       <span class="comment">// Und nächster Tick erst wieder bei -/+ 2 Abweichung vom gleitenden Mittelwert. </span></div>
<div class="line">                       <a class="code" href="a00007.html#ab60e52bf003ad9b344c264c5bf8c71e3" title="Odometriesensor Zaehler bei Interrupt Betrieb.  encoder[0] = links; encoder[1] = rechts.">encoder</a>[adc_cnt^<a class="code" href="a00004.html#a80fb826a684cf3f0d306b22aa100ddac">RIGHT</a>]++; </div>
<div class="line">                       sign[adc_cnt] = -sign [adc_cnt]; </div>
<div class="line">                    } </div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>(adc_cnt==<a class="code" href="a00004.html#ac279a93dfd1f02dac2359cfaa1422b93">SWITCH</a>) {</div>
<div class="line">                <a class="code" href="a00007.html#a3f85635d367e540986605ba72db6f950" title="Flag, dass der Interrupt SIG_INTERRUPT1 durch eine gedrueckte Taste  ausgeloesst wurde. 0 = keine Taste, 1 = Taste gedrueckt.  Kann im eigenen Programm immer abgefragt werden.">switched</a>=<a class="code" href="a00007.html#a3f85635d367e540986605ba72db6f950" title="Flag, dass der Interrupt SIG_INTERRUPT1 durch eine gedrueckte Taste  ausgeloesst wurde. 0 = keine Taste, 1 = Taste gedrueckt.  Kann im eigenen Programm immer abgefragt werden.">switched</a> || sensor&lt;(<a class="code" href="a00019.html#a7ddcb43da228c2c40e2fb42fc8505ff7">MY_SWITCH_THRESHHOLD</a>&lt;&lt;6);  <span class="comment">// Es wurde (ganz sicher) eine Taste gedrückt</span></div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        ADMUX = mux[adc_cnt];</div>
<div class="line">        adc_cnt=(adc_cnt+1) % <span class="keyword">sizeof</span>(mux);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a695028df1fc0b1724dd9e5efed5c47cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SIGNAL </td>
          <td>(</td>
          <td class="paramtype">TIMER2_OVF_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definiert in Zeile <a class="el" href="a00003_source.html#l00356">356</a> der Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  TCNT2 += 0x25;</div>
<div class="line">  <a class="code" href="a00007.html#a61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a> ++;</div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="a00007.html#a61610ea211b4bea5cc5ce6136c3fa4f8" title="Counter fuer 36kHz.">count36kHz</a>)</div>
<div class="line">    <a class="code" href="a00007.html#a8f07cc475f4e813c344e44a6efce8bc2" title="Sytemzeit in ms.">timebase</a> ++;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="a00007.html#ab3982e6520803bb438468a0352755a28" title="Zeiger auf User Funktion die von der Interupt Funktion aus aufgerufen wird.">Ovr2IntFunc</a>)</div>
<div class="line">    <a class="code" href="a00007.html#ab3982e6520803bb438468a0352755a28" title="Zeiger auf User Funktion die von der Interupt Funktion aus aufgerufen wird.">Ovr2IntFunc</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3411350ac14105d620aa51ece56602c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SIGNAL </td>
          <td>(</td>
          <td class="paramtype">ADC_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definiert in Zeile <a class="el" href="a00003_source.html#l00403">403</a> der Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="a00007.html#acb2dd119fea212b6ce56cd76e1076825" title="Zeiger auf User Funktion die von der Interupt Funktion aus aufgerufen wird.">AdcIntFunc</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variablen-Dokumentation</h2>
<a class="anchor" id="a96d1662336df94f7822af3790984c9b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile unsigned int adcValue[6]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definiert in Zeile <a class="el" href="a00003_source.html#l00078">78</a> der Datei <a class="el" href="a00003_source.html">asuro.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Erzeugt am Mit Nov 27 2013 22:55:08 fÃ¼r ASURO Library von &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
